# CVD-COVID-UK consortium, William N Whiteley, et al., 2024.

import sys, csv, re

codes = [{"code":"363369002","system":"icd10"},{"code":"721619003","system":"icd10"},{"code":"372142002","system":"icd10"},{"code":"707492001","system":"icd10"},{"code":"255030002","system":"icd10"},{"code":"372143007","system":"icd10"},{"code":"448952004","system":"icd10"},{"code":"408643008","system":"icd10"},{"code":"313353007","system":"icd10"},{"code":"286887005","system":"icd10"},{"code":"255118005","system":"icd10"},{"code":"307502000","system":"icd10"},{"code":"733608000","system":"icd10"},{"code":"254989000","system":"icd10"},{"code":"372136001","system":"icd10"},{"code":"683991000119103","system":"icd10"},{"code":"313355000","system":"icd10"},{"code":"422691006","system":"icd10"},{"code":"274902006","system":"icd10"},{"code":"254543002","system":"icd10"},{"code":"255109008","system":"icd10"},{"code":"254628007","system":"icd10"},{"code":"254955001","system":"icd10"},{"code":"372141009","system":"icd10"},{"code":"312113007","system":"icd10"},{"code":"1082301000119109","system":"icd10"},{"code":"408642003","system":"icd10"},{"code":"254893005","system":"icd10"},{"code":"109841003","system":"icd10"},{"code":"764694005","system":"icd10"},{"code":"372138000","system":"icd10"},{"code":"254713002","system":"icd10"},{"code":"254900004","system":"icd10"},{"code":"286895009","system":"icd10"},{"code":"254549003","system":"icd10"},{"code":"105121000119102","system":"icd10"},{"code":"254563009","system":"icd10"},{"code":"423158009","system":"icd10"},{"code":"254987003","system":"icd10"},{"code":"286889008","system":"icd10"},{"code":"254551004","system":"icd10"},{"code":"286890004","system":"icd10"},{"code":"254629004","system":"icd10"},{"code":"12240951000119107","system":"icd10"},{"code":"255086002","system":"icd10"},{"code":"278060005","system":"icd10"},{"code":"717735006","system":"icd10"},{"code":"254620000","system":"icd10"},{"code":"286897001","system":"icd10"},{"code":"721638007","system":"icd10"},{"code":"278053004","system":"icd10"},{"code":"254559002","system":"icd10"},{"code":"255028004","system":"icd10"},{"code":"312115000","system":"icd10"},{"code":"285432005","system":"icd10"},{"code":"276870001","system":"icd10"},{"code":"254889004","system":"icd10"},{"code":"91151000119103","system":"icd10"},{"code":"313357008","system":"icd10"},{"code":"254633006","system":"icd10"},{"code":"276954004","system":"icd10"},{"code":"286899003","system":"icd10"},{"code":"254547001","system":"icd10"},{"code":"254856004","system":"icd10"},{"code":"449248000","system":"icd10"},{"code":"274084007","system":"icd10"},{"code":"255008003","system":"icd10"},{"code":"11010461000119101","system":"icd10"},{"code":"427685000","system":"icd10"},{"code":"719052006","system":"icd10"},{"code":"254632001","system":"icd10"},{"code":"707538002","system":"icd10"},{"code":"18121000119104","system":"icd10"},{"code":"707358000","system":"icd10"},{"code":"254424004","system":"icd10"},{"code":"372106005","system":"icd10"},{"code":"1082311000119107","system":"icd10"},{"code":"702392008","system":"icd10"},{"code":"286894008","system":"icd10"},{"code":"254838004","system":"icd10"},{"code":"721618006","system":"icd10"},{"code":"254431000","system":"icd10"},{"code":"254445006","system":"icd10"},{"code":"12240991000119102","system":"icd10"},{"code":"254714008","system":"icd10"},{"code":"278054005","system":"icd10"},{"code":"402815007","system":"icd10"},{"code":"271943005","system":"icd10"},{"code":"255035007","system":"icd10"},{"code":"722672002","system":"icd10"},{"code":"255108000","system":"icd10"},{"code":"109842005","system":"icd10"},{"code":"255003007","system":"icd10"},{"code":"254457002","system":"icd10"},{"code":"255066001","system":"icd10"},{"code":"422599000","system":"icd10"},{"code":"254561006","system":"icd10"},{"code":"254840009","system":"icd10"},{"code":"254878006","system":"icd10"},{"code":"276952000","system":"icd10"},{"code":"255037004","system":"icd10"},{"code":"300988009","system":"icd10"},{"code":"403900000","system":"icd10"},{"code":"254852002","system":"icd10"},{"code":"431396003","system":"icd10"},{"code":"307610008","system":"icd10"},{"code":"707664003","system":"icd10"},{"code":"286902000","system":"icd10"},{"code":"403906006","system":"icd10"},{"code":"254436005","system":"icd10"},{"code":"254612002","system":"icd10"},{"code":"254712007","system":"icd10"},{"code":"276962007","system":"icd10"},{"code":"276804009","system":"icd10"},{"code":"254839007","system":"icd10"},{"code":"444604002","system":"icd10"},{"code":"372113005","system":"icd10"},{"code":"372101000","system":"icd10"},{"code":"286896005","system":"icd10"},{"code":"269533000","system":"icd10"},{"code":"363368005","system":"icd10"},{"code":"285312008","system":"icd10"},{"code":"707456000","system":"icd10"},{"code":"253000007","system":"icd10"},{"code":"448931007","system":"icd10"},{"code":"254895003","system":"icd10"},{"code":"275396004","system":"icd10"},{"code":"254582000","system":"icd10"},{"code":"253001006","system":"icd10"},{"code":"254539001","system":"icd10"},{"code":"255121007","system":"icd10"},{"code":"313354001","system":"icd10"},{"code":"254872007","system":"icd10"},{"code":"255068000","system":"icd10"},{"code":"255031003","system":"icd10"},{"code":"722682001","system":"icd10"},{"code":"702391001","system":"icd10"},{"code":"766979005","system":"icd10"},{"code":"425066001","system":"icd10"},{"code":"254462001","system":"icd10"},{"code":"285310000","system":"icd10"},{"code":"254631008","system":"icd10"},{"code":"716649003","system":"icd10"},{"code":"707582006","system":"icd10"},{"code":"254425003","system":"icd10"},{"code":"276975007","system":"icd10"},{"code":"255119002","system":"icd10"},{"code":"254570009","system":"icd10"},{"code":"312114001","system":"icd10"},{"code":"307216009","system":"icd10"},{"code":"255032005","system":"icd10"},{"code":"254454009","system":"icd10"},{"code":"372096000","system":"icd10"},{"code":"254653005","system":"icd10"},{"code":"71985006","system":"icd10"},{"code":"92767001","system":"icd10"},{"code":"313356004","system":"icd10"},{"code":"312111009","system":"icd10"},{"code":"762458004","system":"icd10"},{"code":"254709009","system":"icd10"},{"code":"254634000","system":"icd10"},{"code":"254434008","system":"icd10"},{"code":"737310005","system":"icd10"},{"code":"254465004","system":"icd10"},{"code":"275394001","system":"icd10"},{"code":"255029007","system":"icd10"},{"code":"275490009","system":"icd10"},{"code":"716659002","system":"icd10"},{"code":"326072005","system":"icd10"},{"code":"254555008","system":"icd10"},{"code":"722542000","system":"icd10"},{"code":"372100004","system":"icd10"},{"code":"255111004","system":"icd10"},{"code":"423973006","system":"icd10"},{"code":"255081007","system":"icd10"},{"code":"707357005","system":"icd10"},{"code":"275395000","system":"icd10"},{"code":"723265000","system":"icd10"},{"code":"423464009","system":"icd10"},{"code":"254711000","system":"icd10"},{"code":"254441002","system":"icd10"},{"code":"254904008","system":"icd10"},{"code":"254622008","system":"icd10"},{"code":"286893002","system":"icd10"},{"code":"254609000","system":"icd10"},{"code":"372140005","system":"icd10"},{"code":"254886006","system":"icd10"},{"code":"254427006","system":"icd10"},{"code":"722524005","system":"icd10"},{"code":"254557000","system":"icd10"},{"code":"372111007","system":"icd10"},{"code":"448930008","system":"icd10"},{"code":"425231005","system":"icd10"},{"code":"274085008","system":"icd10"},{"code":"254619006","system":"icd10"},{"code":"708921005","system":"icd10"},{"code":"92754004","system":"icd10"},{"code":"286900008","system":"icd10"},{"code":"312112002","system":"icd10"},{"code":"254888007","system":"icd10"},{"code":"187769009","system":"icd10"},{"code":"276953005","system":"icd10"},{"code":"713609000","system":"icd10"},{"code":"231831002","system":"icd10"},{"code":"269516007","system":"icd10"},{"code":"254567005","system":"icd10"},{"code":"254915003","system":"icd10"},{"code":"253018005","system":"icd10"},{"code":"254435009","system":"icd10"},{"code":"707422006","system":"icd10"},{"code":"276876007","system":"icd10"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('ccu002_02-cancer-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["ccu002_02-cancer-carcinomatosis---secondary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["ccu002_02-cancer-carcinomatosis---secondary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["ccu002_02-cancer-carcinomatosis---secondary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
